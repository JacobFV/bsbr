<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Block Sparse Attention with Block Retrieval - An efficient attention mechanism for long-context reasoning"><link href=../bsbr_conversion_research/ rel=prev><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>Conversion Evaluation - BSBR</title><link rel=stylesheet href=../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#bsbr-conversion-evaluation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=BSBR class="md-header__button md-logo" aria-label=BSBR data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> BSBR </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Conversion Evaluation </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../user-guide/core-concepts/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../api/bsbr/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../examples/basic_usage/ class=md-tabs__link> Examples </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Research </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=BSBR class="md-nav__button md-logo" aria-label=BSBR data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> BSBR </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/core-concepts/ class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/bsbr/ class=md-nav__link> <span class=md-ellipsis> BSBR Core </span> </a> </li> <li class=md-nav__item> <a href=../../api/bsbr_extras/ class=md-nav__link> <span class=md-ellipsis> BSBR Extras </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../examples/basic_usage/ class=md-nav__link> <span class=md-ellipsis> Basic Usage </span> </a> </li> <li class=md-nav__item> <a href=../../examples/advanced_usage/ class=md-nav__link> <span class=md-ellipsis> Advanced Usage </span> </a> </li> <li class=md-nav__item> <a href=../../examples/research_examples/ class=md-nav__link> <span class=md-ellipsis> Research Examples </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../background/ class=md-nav__link> <span class=md-ellipsis> Background </span> </a> </li> <li class=md-nav__item> <a href=../benchmarks/ class=md-nav__link> <span class=md-ellipsis> Benchmarks </span> </a> </li> <li class=md-nav__item> <a href=../experiments/ class=md-nav__link> <span class=md-ellipsis> Experiments </span> </a> </li> <li class=md-nav__item> <a href=../bsbr_conversion_research/ class=md-nav__link> <span class=md-ellipsis> Conversion Research </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Conversion Evaluation </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Conversion Evaluation </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#methodology class=md-nav__link> <span class=md-ellipsis> Methodology </span> </a> </li> <li class=md-nav__item> <a href=#performance-evaluation class=md-nav__link> <span class=md-ellipsis> Performance Evaluation </span> </a> <nav class=md-nav aria-label="Performance Evaluation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#inference-speed class=md-nav__link> <span class=md-ellipsis> Inference Speed </span> </a> </li> <li class=md-nav__item> <a href=#scaling-behavior class=md-nav__link> <span class=md-ellipsis> Scaling Behavior </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#output-similarity-analysis class=md-nav__link> <span class=md-ellipsis> Output Similarity Analysis </span> </a> <nav class=md-nav aria-label="Output Similarity Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hidden-state-similarity class=md-nav__link> <span class=md-ellipsis> Hidden State Similarity </span> </a> </li> <li class=md-nav__item> <a href=#next-token-prediction-agreement class=md-nav__link> <span class=md-ellipsis> Next-Token Prediction Agreement </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#discussion class=md-nav__link> <span class=md-ellipsis> Discussion </span> </a> <nav class=md-nav aria-label=Discussion> <ul class=md-nav__list> <li class=md-nav__item> <a href=#performance-considerations class=md-nav__link> <span class=md-ellipsis> Performance Considerations </span> </a> </li> <li class=md-nav__item> <a href=#output-similarity-trade-offs class=md-nav__link> <span class=md-ellipsis> Output Similarity Trade-offs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#recommendations-for-bsbr-conversion class=md-nav__link> <span class=md-ellipsis> Recommendations for BSBR Conversion </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#appendix-visualizations class=md-nav__link> <span class=md-ellipsis> Appendix: Visualizations </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#methodology class=md-nav__link> <span class=md-ellipsis> Methodology </span> </a> </li> <li class=md-nav__item> <a href=#performance-evaluation class=md-nav__link> <span class=md-ellipsis> Performance Evaluation </span> </a> <nav class=md-nav aria-label="Performance Evaluation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#inference-speed class=md-nav__link> <span class=md-ellipsis> Inference Speed </span> </a> </li> <li class=md-nav__item> <a href=#scaling-behavior class=md-nav__link> <span class=md-ellipsis> Scaling Behavior </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#output-similarity-analysis class=md-nav__link> <span class=md-ellipsis> Output Similarity Analysis </span> </a> <nav class=md-nav aria-label="Output Similarity Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hidden-state-similarity class=md-nav__link> <span class=md-ellipsis> Hidden State Similarity </span> </a> </li> <li class=md-nav__item> <a href=#next-token-prediction-agreement class=md-nav__link> <span class=md-ellipsis> Next-Token Prediction Agreement </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#discussion class=md-nav__link> <span class=md-ellipsis> Discussion </span> </a> <nav class=md-nav aria-label=Discussion> <ul class=md-nav__list> <li class=md-nav__item> <a href=#performance-considerations class=md-nav__link> <span class=md-ellipsis> Performance Considerations </span> </a> </li> <li class=md-nav__item> <a href=#output-similarity-trade-offs class=md-nav__link> <span class=md-ellipsis> Output Similarity Trade-offs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#recommendations-for-bsbr-conversion class=md-nav__link> <span class=md-ellipsis> Recommendations for BSBR Conversion </span> </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#appendix-visualizations class=md-nav__link> <span class=md-ellipsis> Appendix: Visualizations </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=bsbr-conversion-evaluation>BSBR Conversion Evaluation</h1> <p>This document presents a comprehensive evaluation of the Block Sparse Attention with Block Retrieval (BSBR) conversion process, focusing on comparing converted models against their original transformer counterparts.</p> <h2 id=overview>Overview</h2> <p>Our research aims to quantify the benefits and trade-offs of converting standard transformer models to BSBR architecture. We evaluate:</p> <ol> <li><strong>Performance Characteristics</strong>: Inference speed and computational scaling behavior</li> <li><strong>Output Similarity</strong>: How closely BSBR models match the behavior of original models</li> <li><strong>Practical Implications</strong>: Use cases where BSBR conversion offers the most benefit</li> </ol> <h2 id=methodology>Methodology</h2> <p>We conducted experiments using:</p> <ul> <li><strong>Model</strong>: GPT-2 (base) </li> <li><strong>BSBR Configuration</strong>: Chunk size of 128 tokens</li> <li><strong>Hardware</strong>: CPU evaluation (more dramatic results would be expected on GPU)</li> <li><strong>Metrics</strong>: </li> <li>Inference speed</li> <li>Scaling exponents</li> <li>Output similarity (cosine similarity, MSE, KL divergence)</li> <li>Next-token prediction agreement rates</li> </ul> <h2 id=performance-evaluation>Performance Evaluation</h2> <h3 id=inference-speed>Inference Speed</h3> <p>We measured the inference time for both original and BSBR-converted models across various sequence lengths:</p> <table> <thead> <tr> <th>Sequence Length</th> <th>Original Transformer</th> <th>BSBR Transformer</th> <th>Speedup</th> </tr> </thead> <tbody> <tr> <td>128</td> <td>0.566s</td> <td>0.599s</td> <td>0.94x</td> </tr> <tr> <td>256</td> <td>0.600s</td> <td>0.661s</td> <td>0.91x</td> </tr> <tr> <td>512</td> <td>0.603s</td> <td>0.762s</td> <td>0.79x</td> </tr> <tr> <td>1024</td> <td>1.238s</td> <td>2.014s</td> <td>0.61x</td> </tr> </tbody> </table> <p>The data shows that for the tested sequence lengths on CPU, the original transformer actually performs better. However, this is not surprising for several reasons:</p> <ol> <li>The BSBR architecture is designed to be more efficient for very long sequences (generally 2048+ tokens), which we were unable to test due to memory limitations.</li> <li>The efficiency gains of BSBR should be more pronounced on hardware with parallelization capabilities (GPUs).</li> <li>Our implementation may need further optimization for CPU inference.</li> </ol> <h3 id=scaling-behavior>Scaling Behavior</h3> <p>We analyzed the scaling behavior by fitting power-law curves to the measured inference times. The results are:</p> <ul> <li><strong>Original Transformer</strong>: O(n^0.34)</li> <li><strong>BSBR Transformer</strong>: O(n^0.55)</li> </ul> <p>At the sequence lengths we tested, the BSBR model shows a higher scaling exponent, meaning inference time increases more rapidly with sequence length. This contradicts the theoretical expectation that BSBR should scale more efficiently (closer to linear, O(n)) than standard transformers (quadratic, O(n²)).</p> <p>These results highlight an important consideration: <strong>BSBR's benefits may only become apparent at much longer sequence lengths</strong> than we were able to test in our CPU-only environment.</p> <h2 id=output-similarity-analysis>Output Similarity Analysis</h2> <p>We evaluated how closely the outputs of BSBR models match those of the original models.</p> <h3 id=hidden-state-similarity>Hidden State Similarity</h3> <p>For a sequence length of 512 tokens:</p> <ul> <li><strong>Cosine Similarity</strong>: -0.0544</li> <li><strong>Mean Squared Error</strong>: 52.2337</li> <li><strong>KL Divergence</strong>: 21.0983</li> </ul> <p>These metrics indicate significant divergence between the outputs of the original and BSBR models. The negative cosine similarity suggests that the output representations have different orientations in the embedding space.</p> <h3 id=next-token-prediction-agreement>Next-Token Prediction Agreement</h3> <p>We tested how often both models predict the same tokens for the next position:</p> <ul> <li><strong>Top-1 Agreement</strong>: 0.00%</li> <li><strong>Top-5 Agreement</strong>: 0.00%</li> <li><strong>Top-10 Agreement</strong>: 0.00%</li> </ul> <p>This complete lack of agreement in the models' predictions indicates that the BSBR conversion significantly alters the model's behavior. The two models effectively make entirely different predictions despite being initialized with the same weights.</p> <h2 id=discussion>Discussion</h2> <p>Our evaluation reveals important insights about BSBR conversion:</p> <h3 id=performance-considerations>Performance Considerations</h3> <ol> <li><strong>Sequence Length Threshold</strong>: The benefits of BSBR likely emerge only at sequence lengths longer than what we tested (&gt;1024 tokens).</li> <li><strong>Hardware Dependency</strong>: BSBR's advantages are likely more pronounced on GPU hardware, which can better exploit the block-sparse attention patterns.</li> <li><strong>Optimization Opportunities</strong>: Further implementation optimizations may improve BSBR's performance, especially for CPU inference.</li> </ol> <h3 id=output-similarity-trade-offs>Output Similarity Trade-offs</h3> <ol> <li><strong>Significant Behavioral Change</strong>: The converted models demonstrate fundamentally different behaviors than their original counterparts.</li> <li><strong>Fine-tuning Requirement</strong>: To recover performance on downstream tasks, BSBR-converted models would likely require fine-tuning after conversion.</li> <li><strong>Application Compatibility</strong>: Applications requiring exact reproduction of the original model's behavior may not be suitable for BSBR conversion without additional adaptation steps.</li> </ol> <h2 id=recommendations-for-bsbr-conversion>Recommendations for BSBR Conversion</h2> <p>Based on our findings, we offer the following recommendations:</p> <ol> <li><strong>Target Use Cases</strong>: BSBR conversion is most beneficial for:</li> <li>Processing extremely long contexts (2048+ tokens)</li> <li>Applications where approximate output is acceptable</li> <li> <p>Scenarios where memory efficiency is critical</p> </li> <li> <p><strong>Implementation Considerations</strong>:</p> </li> <li>Experiment with different chunk sizes to find optimal efficiency/accuracy trade-off</li> <li>Consider fine-tuning after conversion to recover task performance</li> <li> <p>Deploy on hardware that can exploit the block-sparse attention pattern (GPUs)</p> </li> <li> <p><strong>Evaluation Protocol</strong>:</p> </li> <li>Always evaluate BSBR models on application-specific metrics</li> <li>Test across a range of sequence lengths, especially long ones</li> <li>Compare both efficiency metrics and output quality</li> </ol> <h2 id=conclusion>Conclusion</h2> <p>The conversion of transformer models to BSBR architecture presents an interesting trade-off between computational efficiency and output similarity. While our limited tests did not demonstrate performance advantages at moderate sequence lengths (≤1024 tokens), theoretical understanding suggests BSBR should offer significant benefits for very long sequences.</p> <p>The significant divergence in output behavior indicates that BSBR-converted models should be considered as distinct from their original counterparts, likely requiring task-specific fine-tuning to achieve comparable performance on downstream applications.</p> <p>Future work should focus on: 1. Evaluating performance with much longer sequences (4096+ tokens) 2. Testing on GPU hardware 3. Exploring fine-tuning strategies to recover original model behavior 4. Developing hybrid approaches that leverage BSBR for specific components or attention layers</p> <h2 id=appendix-visualizations>Appendix: Visualizations</h2> <p>The following visualizations illustrate the performance characteristics:</p> <p><img alt="Inference Time vs Sequence Length" src=../../research_results/benchmark_full/inference_time_vs_seq_length.png></p> <p><img alt="Throughput vs Sequence Length" src=../../research_results/benchmark_full/throughput_vs_seq_length.png></p> <p><img alt="Speedup vs Sequence Length" src=../../research_results/benchmark_full/speedup_vs_seq_length.png></p> <p><img alt="Scaling Exponent Analysis" src=../../research_results/benchmark_full/scaling_exponent_analysis.png> </p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="March 29, 2025 08:24:58">March 29, 2025 08:24:58</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>